jQuery(document).ready((function(t){var e=localStorage.getItem("activeTab");e?(t(".nav-tab").removeClass("nav-tab-active"),t(".tab-content").removeClass("active"),t('.nav-tab[href="'.concat(e,'"]')).addClass("nav-tab-active"),t(e).addClass("active")):(t(".nav-tab").first().addClass("nav-tab-active"),t(".tab-content").first().addClass("active")),t(".nav-tab").on("click",(function(e){e.preventDefault(),t(".nav-tab").removeClass("nav-tab-active"),t(this).addClass("nav-tab-active"),t(".tab-content").removeClass("active"),t(t(this).attr("href")).addClass("active"),localStorage.setItem("activeTab",t(this).attr("href"))}))})),jQuery(document).ready((function(t){t(".file-upload-input").on("change",(function(e){var n=e.target.files[0],o=t(".file-upload-preview");n&&o.html(' \n                <div class="file-name-display">\n                    ðŸ“„ '.concat(n.name,"\n                </div>\n            "))}))})),jQuery(document).ready((function(t){function e(e){var n=t('\n            <div class="wc-toast '.concat(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success",'">\n                ').concat(e,"\n            </div>\n        "));t("#toast-container").append(n),setTimeout((function(){return n.css("opacity","1")}),10),setTimeout((function(){n.css("opacity","0"),setTimeout((function(){return n.remove()}),300)}),3e3)}t("#toast-container").length||t("body").append('<div id="toast-container" style="position: fixed; top: 40px; right: 20px; z-index: 10000;"></div>');var n,o=!1,r=0,a=0,c=0,s=0,i=!1;function d(t){var e=Math.floor(t/1e3),n=Math.floor(e/60),o=Math.floor(n/60);return"".concat(o,"h ").concat(n%60,"m ").concat(e%60,"s")}function p(){var e=a+c,o=e/r*100;t(".progress-bar").css("width",o+"%"),t("#total-processed").text(e),t("#success-count").text(a),t("#failed-count").text(c);var s=e/((Date.now()-n)/1e3);t("#processing-rate").text(s.toFixed(2));var i=(r-e)/s;t("#time-remaining").text(d(1e3*i)),t("#elapsed-time").text(d(Date.now()-n))}function u(){if(!o||i)return l("Order Generation stopped","warning"),void e("Order Generation stopped","warning");var n=r-(a+c);if(n<=0)return l("Order Generation complete!","success"),void e("Order Generation complete!","success");var d=Math.min(t("#batch_size").val(),n);t("#generation-status").text("Processing batch ".concat(s+1,"...")).removeClass().addClass("notice notice-info").show(),t.ajax({url:wcOrderGenerator.ajaxurl,type:"POST",data:{action:"process_order_batch",nonce:wcOrderGenerator.nonce,batch_size:d,batch_number:s},success:function(t){t.success?(a+=t.data.success,c+=t.data.failed,s++,p(),i?(l("Generation stopped","warning"),e("Order Generation stopped","warning")):setTimeout(u,500)):(f("Error processing batch: "+t.data),e("Eror processing batch","error"))},error:function(t,n,o){i?(l("Generation stopped","warning"),e("Order Generation stopped","warning")):(f("Server error occurred: "+o),e("Server error occurred","error"))}})}function l(e,n){t("#generation-status").text(e).removeClass().addClass("notice notice-".concat(n)).show(),o=!1,i=!1,t("#start-generation").prop("disabled",!1),t("#stop-generation").prop("disabled",!0),t("#reset-generation").show()}function f(e){c+=0,p(),t("#time-remaining").text(d(c)),l(e,"error")}t("#order-generator-form").on("submit",(function(e){e.preventDefault();var d=parseInt(t("#num_orders").val());if(d<1||d>1e4)alert("Please enter a number between 1 and 10k");else{var p=parseInt(t("#batch_size").val());p<5||p>30?alert("Please enter a batch number between 5 and 30"):(o=!0,i=!1,r=d,a=0,c=0,s=0,n=Date.now(),t("#start-generation").prop("disabled",!0),t("#stop-generation").prop("disabled",!1),t("#reset-generation").hide(),t("#generation-status").text("Starting generation...").removeClass().addClass("notice notice-info").show(),t(".progress-bar").css("width","0%"),u())}})),t("#stop-generation").on("click",(function(){o&&(i=!0,t(this).prop("disabled",!0),t("#generation-status").text("Stopping generation...").removeClass().addClass("notice notice-warning").show(),t.ajax({url:wcOrderGenerator.ajaxurl,type:"POST",data:{action:"stop_order_generation",nonce:wcOrderGenerator.nonce}}).fail((function(t,e,n){})))})),t("#reset-generation").on("click",(function(){o=!1,i=!1,r=0,a=0,c=0,s=0,t(".progress-bar").css("width","0%"),t("#total-processed").text("0"),t("#success-count").text("0"),t("#failed-count").text("0"),t("#processing-rate").text("0"),t("#elapsed-time").text("0s"),t("#time-remaining").text("--"),t("#num_orders").val("100"),t("#start-generation").prop("disabled",!1),t("#stop-generation").prop("disabled",!0),t("#reset-generation").hide(),t("#generation-status").hide()}))})),jQuery(document).ready((function(t){function e(e){var n=t('\n            <div class="wc-toast '.concat(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success",'">\n                ').concat(e,"\n            </div>\n        "));t("#toast-container").append(n),setTimeout((function(){return n.css("opacity","1")}),10),setTimeout((function(){n.css("opacity","0"),setTimeout((function(){return n.remove()}),300)}),3e3)}t("#toast-container").length||t("body").append('<div id="toast-container" style="position: fixed; top: 40px; right: 20px; z-index: 10000;"></div>');var n=!1,o=0,r=0,a=0,c=0;function s(){var e=(r+a)/o*100;t(".product-progress-bar").css("width",e+"%"),t("#products-processed").text(r),t("#products-failed").text(a)}function i(){if(!n)return t("#product-generation-status").text("Generation stopped").removeClass().addClass("notice notice-warning").show(),t("#start-product-generation").prop("disabled",!1),t("#stop-product-generation").prop("disabled",!0),t("#reset-product-generation").show(),void e("Product Generation stopped","warning");var p=o-(r+a);if(p<=0)return t("#product-generation-status").text("Product generation complete!").removeClass().addClass("notice notice-success").show(),t("#start-product-generation").prop("disabled",!1),t("#stop-product-generation").prop("disabled",!0),t("#reset-product-generation").show(),void e("Product Generation complete!","success");var u=Math.min(t("#product_batch_size").val(),p);t("#product-generation-status").text("Processing product batch ".concat(c+1,"...")).removeClass().addClass("notice notice-info").show(),t.ajax({url:wcOrderGenerator.ajaxurl,type:"POST",data:{action:"process_product_batch",nonce:wcOrderGenerator.products_nonce,batch_size:u,price_min:t("#price_min").val(),price_max:t("#price_max").val(),batch_number:c},success:function(t){t.success?(r+=t.data.success,a+=t.data.failed,c++,s(),setTimeout(i,500)):d("Error processing product batch: "+t.data)},error:function(){d("Server error occurred during product generation")}})}function d(e){a+=parseInt(t("#product_batch_size").val()),s(),t("#product-generation-status").text(e).removeClass().addClass("notice notice-error").show(),n=!1,t("#start-product-generation").prop("disabled",!1),t("#stop-product-generation").prop("disabled",!0),t("#reset-product-generation").show()}t("#product-generator-form").on("submit",(function(e){e.preventDefault();var s=parseInt(t("#num_products").val());if(s<1||s>1e4)alert("Please enter a number between 1 and 10k");else{var d=parseInt(t("#product_batch_size").val());d<5||d>30?alert("Please enter a batch number between 5 and 30"):(n=!0,o=s,r=0,a=0,c=0,Date.now(),t("#start-product-generation").prop("disabled",!0),t("#stop-product-generation").prop("disabled",!1),t("#reset-product-generation").hide(),t("#product-generation-status").text("Starting product generation...").removeClass().addClass("notice notice-info").show(),t(".product-progress-bar").css("width","0%"),i())}})),t("#stop-product-generation").on("click",(function(){n=!1,t(this).prop("disabled",!0),t("#product-generation-status").text("Stopping product generation...").removeClass().addClass("notice notice-warning").show()})),t("#reset-product-generation").on("click",(function(){n=!1,o=0,r=0,a=0,c=0,t(".product-progress-bar").css("width","0%"),t("#products-processed").text("0"),t("#products-failed").text("0"),t("#start-product-generation").prop("disabled",!1),t("#stop-product-generation").prop("disabled",!0),t("#reset-product-generation").hide(),t("#product-generation-status").hide()}))})),jQuery(document).ready((function(t){function e(e){var n=t('\n            <div class="wc-toast '.concat(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success",'">\n                ').concat(e,"\n            </div>\n        "));t("#toast-container").append(n),setTimeout((function(){return n.css("opacity","1")}),10),setTimeout((function(){n.css("opacity","0"),setTimeout((function(){return n.remove()}),300)}),3e3)}t("#toast-container").length||t("body").append('<div id="toast-container" style="position: fixed; top: 40px; right: 20px; z-index: 10000;"></div>');var n=0,o=0;function r(c,s){var i=parseInt(t("#export-batch-size").val()),d=t("#export-status").val()||[],p=Math.ceil(n/i);t.ajax({url:wcOrderGenerator.ajaxurl,type:"POST",data:{action:"export_order_batch",nonce:wcOrderGenerator.export_nonce,batch_size:i,batch_number:c,total_batches:p,export_all:!0,statuses:d,export_session:s},success:function(d){if(d.success){var p=(c+1)*i;!function(r,c,s){if(!n||n<=0)e("Exporting number of order not found!","info");else{var i=Math.min(r/n*100,100);t(".export-progress-bar").css({width:i+"%","background-color":"blue",height:"25px",transition:"width 0.5s ease-in-out"}),t("#export-total-processed").text(r),t("#export-success-count").text(c),t("#export-failed-count").text(s);var d=Date.now(),p=o?d-o:0;t("#export-elapsed-time").text(p>0?a(p):"0s");var u=p>0?r/(p/1e3):0,l=n-r,f=u>0?l/u:0;t("#export-time-remaining").text(f>0?a(1e3*f):"0s")}}(Math.min(p,n),d.data.success,d.data.failed),d.data.is_last_batch?(t("#start-order-export").prop("disabled",!1),window.location.href=d.data.download_url):r(c+1,s)}else e("Export batch failed!"+d.data,"error")}})}function a(t){var e=Math.floor(t/1e3),n=Math.floor(e/60),o=Math.floor(n/60);return"".concat(o,"h ").concat(n%60,"m ").concat(e%60,"s")}t("#export-all").prop("checked",!0),t("#order-export-form").on("submit",(function(a){a.preventDefault();var c=parseInt(t("#export-batch-size").val()),s=t("#export-status").val()||[];t.ajax({url:wcOrderGenerator.ajaxurl,type:"POST",data:{action:"start_order_export",nonce:wcOrderGenerator.export_nonce,batch_size:c,export_all:!0,statuses:s},success:function(a){a.success?(n=a.data.total_orders,o=Date.now(),t("#start-order-export").prop("disabled",!0),r(0,a.data.export_session)):e("Export initialization failed: "+a.data,"error")}})})),t("#reset-order-export").on("click",(function(){t(".export-progress-bar").css("width","0%"),t("#export-total-processed, #export-success-count, #export-failed-count").text("0"),t("#export-elapsed-time").text("0s"),t("#export-time-remaining").text("--"),t("#start-order-export").prop("disabled",!1)}))})),jQuery(document).ready((function(t){function e(e){var n=t('\n            <div class="wc-toast '.concat(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success",'">\n                ').concat(e,"\n            </div>\n        "));t("#toast-container").append(n),setTimeout((function(){return n.css("opacity","1")}),10),setTimeout((function(){n.css("opacity","0"),setTimeout((function(){return n.remove()}),300)}),3e3)}t("#toast-container").length||t("body").append('<div id="toast-container" style="position: fixed; top: 40px; right: 20px; z-index: 10000;"></div>'),t("#order-import-form").on("submit",(function(n){n.preventDefault();var o=t(".file-upload-input")[0].files[0];if(!o)return e("Please select a CSV file","warning"),n.preventDefault(),!1;var r=o.name.toLowerCase().endsWith(".csv");if(!["text/csv","application/vnd.ms-excel"].includes(o.type)||!r)return e("Invalid file type. Please upload a .csv file","error"),n.preventDefault(),!1;if(o.size>5242880)return e("File size exceeds 5MB limit","warning"),n.preventDefault(),!1;var a=new FormData(this);a.append("action","import_orders"),a.append("nonce",wcOrderGenerator.import_nonce),a.append("current_batch",0);var c=Date.now(),s=0,i=0;!function n(o){t.ajax({url:wcOrderGenerator.ajaxurl,type:"POST",data:o,processData:!1,contentType:!1,success:function(r){if(r.success){var a=Date.now(),d=Math.floor((a-c)/1e3);s=r.data.total_orders,i+=r.data.successful,t("#import-total-processed").text(i),t("#import-success-count").text(i),t("#import-failed-count").text(r.data.failed),t("#import-skipped-count").text(r.data.skipped),t("#import-elapsed-time").text(d+"s");var p=Math.floor(i/s*100);if(t(".import-progress-bar").css({width:p+"%","background-color":"blue",height:"25px",transition:"width 0.5s ease-in-out"}),r.data.is_complete)return e("Order Import complete!","success"),void t(".import-progress-bar").css("background-color","green");var u=new FormData;u.append("action","import_orders"),u.append("nonce",wcOrderGenerator.import_nonce),u.append("current_batch",r.data.current_batch+1),u.append("csv_file",o.get("csv_file")),u.append("batch_size",o.get("batch_size")),n(u)}else e("Order Import failed!"+r.data,"warning")},error:function(){e("Server error occurred!","error")}})}(a)})),t("#reset-order-import").on("click",(function(){exportIsGenerating=!1,t(".import-progress-bar").css("width","0%"),t("#import-total-processed, #import-success-count, #import-failed-count").text("0"),t("#import-elapsed-time").text("0s"),t(".file-upload-input").val(""),t(".file-upload-preview").html('\n            <div class="upload-placeholder">\n                <i class="upload-icon">ðŸ“¤</i>\n                <span class="upload-text">Drag & Drop or Click to Upload CSV</span>\n            </div>\n        ')}))})),jQuery(document).ready((function(t){var e=3e3;function n(e){var n=t('\n            <div class="wc-toast '.concat(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success",'">\n                ').concat(e,"\n            </div>\n        "));t("#toast-container").append(n),setTimeout((function(){return n.css("opacity","1")}),10),setTimeout((function(){n.css("opacity","0"),setTimeout((function(){return n.remove()}),300)}),3e3)}function o(e,n){var o=t('\n            <div class="wc-confirm-dialog">\n                <div class="wc-confirm-content">\n                    <h3>Confirm Deletion</h3>\n                    <p>Are you absolutely sure you want to delete ALL '.concat(e,'s? This action cannot be undone!</p>\n                    <div class="wc-confirm-buttons">\n                        <button class="button button-secondary cancel-delete">Cancel</button>\n                        <button class="button button-primary confirm-delete">Confirm Delete</button>\n                    </div>\n                </div>\n            </div>\n        ')).appendTo("body");o.find(".cancel-delete").on("click",(function(){o.remove()})),o.find(".confirm-delete").on("click",(function(){o.remove(),n()}))}function r(o){var c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;t("#delete-".concat(o,"s-btn .poc-spinner")).show(),t("#delete-".concat(o,"s-btn")).prop("disabled",!0),t.ajax({url:wcOrderGenerator.ajaxurl,type:"POST",data:{action:"poc_get_counts",nonce:wcOrderGenerator.poc_nonce},success:function(e){if(e.success){var r="product"===o?e.data.product_count:e.data.order_count;if(0===r)return n("No ".concat(o,"s found to delete."),"warning"),void i(o);t("#".concat(o,"-total")).text(r);var c='\n                        <div class="info-container" style="display: flex; justify-content: space-between; margin-top: 10px;">\n                            <div style="display: flex; gap: 20px;">\n                                <div class="skip-info">Skipped: <span id="'.concat(o,'-skipped">0</span></div>\n                                <div class="retry-info">Retry: <span id="').concat(o,'-retry-count">0</span></div>\n                            </div>\n                            <div class="count-progress" id="').concat(o,'-count-progress">Progress: 0/').concat(r,"</div>\n                        </div>\n                    ");t("#".concat(o,"-progress-container .info-container")).remove(),t("#".concat(o,"-progress-container")).append(c),t("#".concat(o,"-progress-container")).slideDown(300),n("Starting ".concat(o," deletion process..."),"info"),setTimeout((function(){a(o,0,r,0,0,0)}),500)}else s(o,e.data||"Error getting counts")},error:function(t,n,a){c<3?setTimeout((function(){r(o,c+1)}),e):s(o,"Failed to initialize after ".concat(3," attempts: ").concat(a))}})}function a(o,r,i,d,p,u){t("#".concat(o,"-retry-count")).text(u),u>0&&(d=parseInt(t("#".concat(o,"-skipped")).text())+1,t("#".concat(o,"-skipped")).text(d),n("Retrying batch deletion (Attempt ".concat(u," of ").concat(3,")"),"warning")),t.ajax({url:wcOrderGenerator.ajaxurl,type:"POST",timeout:3e4,data:{action:"poc_delete_".concat(o,"s_batch"),nonce:wcOrderGenerator.poc_nonce,offset:r},success:function(l){if(l.success){var f=l.data.deleted+l.data.skipped,v=p+f,g=d+(l.data.skipped||0),m=Math.round(v/i*100);t("#".concat(o,"-progress-bar")).css("width",m+"%"),t("#".concat(o,"-processed")).text(v),t("#".concat(o,"-skipped")).text(g),t("#".concat(o,"-count-progress")).text("Progress: ".concat(v,"/").concat(i)),t("#".concat(o,"-retry-count")).text("0"),l.data.errors&&l.data.errors.length>0&&n("Some ".concat(o,"s could not be deleted"),"warning"),l.data.done?setTimeout((function(){c(o,g,v)}),2e3):setTimeout((function(){a(o,r+f,i,g,v,0)}),1e3)}else u<3?setTimeout((function(){a(o,r,i,d,p,u+1)}),e):s(o,l.data||"Error deleting ".concat(o,"s"))},error:function(t,n,c){u<3?setTimeout((function(){a(o,r,i,d,p,u+1)}),e):s(o,"Failed to process batch after ".concat(3," attempts: ").concat(c))}})}function c(o,a,i){var d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;t.ajax({url:wcOrderGenerator.ajaxurl,type:"POST",data:{action:"poc_get_counts",nonce:wcOrderGenerator.poc_nonce},success:function(e){if(e.success){var c,p="product"===o?e.data.product_count:e.data.order_count;if(t("#delete-".concat(o,"s-btn .poc-spinner")).hide(),0===p||p===a)n(c="Operation completed!\n".concat(a," ").concat(o,"s were skipped\n").concat(i-a," ").concat(o,"s have been successfully deleted!"),"success");else{if(!(p<a)){var u=d+1;return t("#".concat(o,"-retry-count")).text(u),n("Additional ".concat(o,"s found. Continuing deletion process... (Attempt ").concat(u,")"),"info"),void setTimeout((function(){r(o)}),5e3)}n(c="Operation completed!\n".concat(p," ").concat(o,"s remain\n").concat(i-p," ").concat(o,"s have been successfully deleted!"),"success")}var l='\n                        <div class="notice notice-success">\n                            <p>'.concat(c.replace(/\n/g,"<br>"),"</p>\n                        </div>\n                    ");t(".wrap h2").after(l)}else s(o,"Error verifying ".concat(o," deletion"))},error:function(t,n,r){d<3?setTimeout((function(){c(o,a,i,d+1)}),e):s(o,"Failed to verify deletion after ".concat(3," attempts: ").concat(r))}})}function s(e,o){t("#delete-".concat(e,"s-btn .poc-spinner")).hide(),t("#delete-".concat(e,"s-btn")).prop("disabled",!1),n(o,"error")}function i(e){t("#".concat(e,"-progress-bar")).css("width","0%"),t("#".concat(e,"-processed")).text("0"),t("#".concat(e,"-total")).text("0"),t("#".concat(e,"-skipped")).text("0"),t("#".concat(e,"-retry-count")).text("0"),t("#".concat(e,"-count-progress")).text("Progress: 0/0"),t("#delete-".concat(e,"s-btn")).prop("disabled",!1),t("#delete-".concat(e,"s-btn .poc-spinner")).hide(),n("".concat(e.charAt(0).toUpperCase()+e.slice(1)," progress has been reset successfully!"),"success")}t("#toast-container").length||t("body").append('<div id="toast-container" style="position: fixed; top: 40px; right: 20px; z-index: 10000;"></div>'),t("#delete-products-btn").click((function(){o("product",(function(){r("product")}))})),t("#delete-orders-btn").click((function(){o("order",(function(){r("order")}))})),["product","order"].forEach((function(e){t("<button>",{id:"reset-".concat(e,"-progress-btn"),class:"button button-secondary",text:"Reset",css:{float:"right","margin-left":"10px"}}).insertAfter("#".concat(e,"-progress-container"))})),t("#reset-product-progress-btn").on("click",(function(){i("product")})),t("#reset-order-progress-btn").on("click",(function(){i("order")}))}));