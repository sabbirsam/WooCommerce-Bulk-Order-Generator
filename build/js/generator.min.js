jQuery(document).ready((function(e){var t=localStorage.getItem("activeTab");t?(e(".nav-tab").removeClass("nav-tab-active"),e(".tab-content").removeClass("active"),e('.nav-tab[href="'.concat(t,'"]')).addClass("nav-tab-active"),e(t).addClass("active")):(e(".nav-tab").first().addClass("nav-tab-active"),e(".tab-content").first().addClass("active")),e(".nav-tab").on("click",(function(t){t.preventDefault(),e(".nav-tab").removeClass("nav-tab-active"),e(this).addClass("nav-tab-active"),e(".tab-content").removeClass("active"),e(e(this).attr("href")).addClass("active"),localStorage.setItem("activeTab",e(this).attr("href"))}))})),jQuery(document).ready((function(e){e(".file-upload-input").on("change",(function(t){var o=t.target.files[0],r=e(".file-upload-preview");o&&r.html(' \n                <div class="file-name-display">\n                    ðŸ“„ '.concat(o.name,"\n                </div>\n            "))}))})),jQuery(document).ready((function(e){function t(t){var o=e('\n            <div class="wc-toast '.concat(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success",'">\n                ').concat(t,"\n            </div>\n        "));e("#toast-container").append(o),setTimeout((function(){return o.css("opacity","1")}),10),setTimeout((function(){o.css("opacity","0"),setTimeout((function(){return o.remove()}),300)}),3e3)}e("#toast-container").length||e("body").append('<div id="toast-container" style="position: fixed; top: 40px; right: 20px; z-index: 10000;"></div>');var o,r=!1,n=0,a=0,s=0,c=0,i=!1;function d(e){var t=Math.floor(e/1e3),o=Math.floor(t/60),r=Math.floor(o/60);return"".concat(r,"h ").concat(o%60,"m ").concat(t%60,"s")}function p(){var t=a+s,r=t/n*100;e(".progress-bar").css("width",r+"%"),e("#total-processed").text(t),e("#success-count").text(a),e("#failed-count").text(s);var c=t/((Date.now()-o)/1e3);e("#processing-rate").text(c.toFixed(2));var i=(n-t)/c;e("#time-remaining").text(d(1e3*i)),e("#elapsed-time").text(d(Date.now()-o))}function u(){if(!r||i)return l("Order Generation stopped","warning"),void t("Order Generation stopped","warning");var o=n-(a+s);if(o<=0)return l("Order Generation complete!","success"),void t("Order Generation complete!","success");var d=Math.min(e("#batch_size").val(),o);e("#generation-status").text("Processing batch ".concat(c+1,"...")).removeClass().addClass("notice notice-info").show(),e.ajax({url:wcOrderGenerator.ajaxurl,type:"POST",data:{action:"process_order_batch",nonce:wcOrderGenerator.nonce,batch_size:d,batch_number:c},success:function(e){e.success?(a+=e.data.success,s+=e.data.failed,c++,p(),i?(l("Generation stopped","warning"),t("Order Generation stopped","warning")):setTimeout(u,500)):(f("Error processing batch: "+e.data),t("Eror processing batch","error"))},error:function(e,o,r){i?(l("Generation stopped","warning"),t("Order Generation stopped","warning")):(f("Server error occurred: "+r),t("Server error occurred","error"))}})}function l(t,o){e("#generation-status").text(t).removeClass().addClass("notice notice-".concat(o)).show(),r=!1,i=!1,e("#start-generation").prop("disabled",!1),e("#stop-generation").prop("disabled",!0),e("#reset-generation").show()}function f(e){s+=batchSize,p(),l(e,"error")}e("#order-generator-form").on("submit",(function(t){t.preventDefault();var d=parseInt(e("#num_orders").val());if(d<1||d>1e4)alert("Please enter a number between 1 and 10k");else{var p=parseInt(e("#batch_size").val());p<5||p>30?alert("Please enter a batch number between 5 and 30"):(r=!0,i=!1,n=d,a=0,s=0,c=0,o=Date.now(),e("#start-generation").prop("disabled",!0),e("#stop-generation").prop("disabled",!1),e("#reset-generation").hide(),e("#generation-status").text("Starting generation...").removeClass().addClass("notice notice-info").show(),e(".progress-bar").css("width","0%"),u())}})),e("#stop-generation").on("click",(function(){r&&(i=!0,e(this).prop("disabled",!0),e("#generation-status").text("Stopping generation...").removeClass().addClass("notice notice-warning").show(),e.ajax({url:wcOrderGenerator.ajaxurl,type:"POST",data:{action:"stop_order_generation",nonce:wcOrderGenerator.nonce}}).fail((function(e,t,o){})))})),e("#reset-generation").on("click",(function(){r=!1,i=!1,n=0,a=0,s=0,c=0,e(".progress-bar").css("width","0%"),e("#total-processed").text("0"),e("#success-count").text("0"),e("#failed-count").text("0"),e("#processing-rate").text("0"),e("#elapsed-time").text("0s"),e("#time-remaining").text("--"),e("#num_orders").val("100"),e("#start-generation").prop("disabled",!1),e("#stop-generation").prop("disabled",!0),e("#reset-generation").hide(),e("#generation-status").hide()}))})),jQuery(document).ready((function(e){function t(t){var o=e('\n            <div class="wc-toast '.concat(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success",'">\n                ').concat(t,"\n            </div>\n        "));e("#toast-container").append(o),setTimeout((function(){return o.css("opacity","1")}),10),setTimeout((function(){o.css("opacity","0"),setTimeout((function(){return o.remove()}),300)}),3e3)}e("#toast-container").length||e("body").append('<div id="toast-container" style="position: fixed; top: 40px; right: 20px; z-index: 10000;"></div>');var o=!1,r=0,n=0,a=0,s=0;function c(){var t=(n+a)/r*100;e(".product-progress-bar").css("width",t+"%"),e("#products-processed").text(n),e("#products-failed").text(a)}function i(){if(!o)return e("#product-generation-status").text("Generation stopped").removeClass().addClass("notice notice-warning").show(),e("#start-product-generation").prop("disabled",!1),e("#stop-product-generation").prop("disabled",!0),e("#reset-product-generation").show(),void t("Product Generation stopped","warning");var p=r-(n+a);if(p<=0)return e("#product-generation-status").text("Product generation complete!").removeClass().addClass("notice notice-success").show(),e("#start-product-generation").prop("disabled",!1),e("#stop-product-generation").prop("disabled",!0),e("#reset-product-generation").show(),void t("Product Generation complete!","success");var u=Math.min(e("#product_batch_size").val(),p);e("#product-generation-status").text("Processing product batch ".concat(s+1,"...")).removeClass().addClass("notice notice-info").show(),e.ajax({url:wcOrderGenerator.ajaxurl,type:"POST",data:{action:"process_product_batch",nonce:wcOrderGenerator.products_nonce,batch_size:u,price_min:e("#price_min").val(),price_max:e("#price_max").val(),batch_number:s},success:function(e){e.success?(n+=e.data.success,a+=e.data.failed,s++,c(),setTimeout(i,500)):d("Error processing product batch: "+e.data)},error:function(){d("Server error occurred during product generation")}})}function d(t){a+=parseInt(e("#product_batch_size").val()),c(),e("#product-generation-status").text(t).removeClass().addClass("notice notice-error").show(),o=!1,e("#start-product-generation").prop("disabled",!1),e("#stop-product-generation").prop("disabled",!0),e("#reset-product-generation").show()}e("#product-generator-form").on("submit",(function(t){t.preventDefault();var c=parseInt(e("#num_products").val());if(c<1||c>1e4)alert("Please enter a number between 1 and 10k");else{var d=parseInt(e("#product_batch_size").val());d<5||d>30?alert("Please enter a batch number between 5 and 30"):(o=!0,r=c,n=0,a=0,s=0,Date.now(),e("#start-product-generation").prop("disabled",!0),e("#stop-product-generation").prop("disabled",!1),e("#reset-product-generation").hide(),e("#product-generation-status").text("Starting product generation...").removeClass().addClass("notice notice-info").show(),e(".product-progress-bar").css("width","0%"),i())}})),e("#stop-product-generation").on("click",(function(){o=!1,e(this).prop("disabled",!0),e("#product-generation-status").text("Stopping product generation...").removeClass().addClass("notice notice-warning").show()})),e("#reset-product-generation").on("click",(function(){o=!1,r=0,n=0,a=0,s=0,e(".product-progress-bar").css("width","0%"),e("#products-processed").text("0"),e("#products-failed").text("0"),e("#start-product-generation").prop("disabled",!1),e("#stop-product-generation").prop("disabled",!0),e("#reset-product-generation").hide(),e("#product-generation-status").hide()}))})),jQuery(document).ready((function(e){function t(t){var o=e('\n            <div class="wc-toast '.concat(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success",'">\n                ').concat(t,"\n            </div>\n        "));e("#toast-container").append(o),setTimeout((function(){return o.css("opacity","1")}),10),setTimeout((function(){o.css("opacity","0"),setTimeout((function(){return o.remove()}),300)}),3e3)}e("#toast-container").length||e("body").append('<div id="toast-container" style="position: fixed; top: 40px; right: 20px; z-index: 10000;"></div>');var o=0,r=0;function n(s,c){var i=parseInt(e("#export-batch-size").val()),d=e("#export-status").val()||[],p=Math.ceil(o/i);e.ajax({url:wcOrderGenerator.ajaxurl,type:"POST",data:{action:"export_order_batch",nonce:wcOrderGenerator.export_nonce,batch_size:i,batch_number:s,total_batches:p,export_all:!0,statuses:d,export_session:c},success:function(d){if(d.success){var p=(s+1)*i;!function(n,s,c){if(!o||o<=0)t("Exporting number of order not found!","info");else{var i=Math.min(n/o*100,100);e(".export-progress-bar").css({width:i+"%","background-color":"blue",height:"25px",transition:"width 0.5s ease-in-out"}),e("#export-total-processed").text(n),e("#export-success-count").text(s),e("#export-failed-count").text(c);var d=Date.now(),p=r?d-r:0;e("#export-elapsed-time").text(p>0?a(p):"0s");var u=p>0?n/(p/1e3):0,l=o-n,f=u>0?l/u:0;e("#export-time-remaining").text(f>0?a(1e3*f):"0s")}}(Math.min(p,o),d.data.success,d.data.failed),d.data.is_last_batch?(e("#start-order-export").prop("disabled",!1),window.location.href=d.data.download_url):n(s+1,c)}else t("Export batch failed!"+d.data,"error")}})}function a(e){var t=Math.floor(e/1e3),o=Math.floor(t/60),r=Math.floor(o/60);return"".concat(r,"h ").concat(o%60,"m ").concat(t%60,"s")}e("#export-all").prop("checked",!0),e("#order-export-form").on("submit",(function(a){a.preventDefault();var s=parseInt(e("#export-batch-size").val()),c=e("#export-status").val()||[];e.ajax({url:wcOrderGenerator.ajaxurl,type:"POST",data:{action:"start_order_export",nonce:wcOrderGenerator.export_nonce,batch_size:s,export_all:!0,statuses:c},success:function(a){a.success?(o=a.data.total_orders,r=Date.now(),e("#start-order-export").prop("disabled",!0),n(0,a.data.export_session)):t("Export initialization failed: "+a.data,"error")}})})),e("#reset-order-export").on("click",(function(){e(".export-progress-bar").css("width","0%"),e("#export-total-processed, #export-success-count, #export-failed-count").text("0"),e("#export-elapsed-time").text("0s"),e("#export-time-remaining").text("--"),e("#start-order-export").prop("disabled",!1)}))})),jQuery(document).ready((function(e){function t(t){var o=e('\n            <div class="wc-toast '.concat(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success",'">\n                ').concat(t,"\n            </div>\n        "));e("#toast-container").append(o),setTimeout((function(){return o.css("opacity","1")}),10),setTimeout((function(){o.css("opacity","0"),setTimeout((function(){return o.remove()}),300)}),3e3)}e("#toast-container").length||e("body").append('<div id="toast-container" style="position: fixed; top: 40px; right: 20px; z-index: 10000;"></div>'),e("#order-import-form").on("submit",(function(o){o.preventDefault();var r=e(".file-upload-input")[0].files[0];if(!r)return t("Please select a CSV file","warning"),o.preventDefault(),!1;var n=r.name.toLowerCase().endsWith(".csv");if(!["text/csv","application/vnd.ms-excel"].includes(r.type)||!n)return t("Invalid file type. Please upload a .csv file","error"),o.preventDefault(),!1;if(r.size>5242880)return t("File size exceeds 5MB limit","warning"),o.preventDefault(),!1;var a=new FormData(this);a.append("action","import_orders"),a.append("nonce",wcOrderGenerator.import_nonce),a.append("current_batch",0);var s=Date.now(),c=0,i=0;!function o(r){e.ajax({url:wcOrderGenerator.ajaxurl,type:"POST",data:r,processData:!1,contentType:!1,success:function(n){if(n.success){var a=Date.now(),d=Math.floor((a-s)/1e3);c=n.data.total_orders,i+=n.data.successful,e("#import-total-processed").text(i),e("#import-success-count").text(i),e("#import-failed-count").text(n.data.failed),e("#import-skipped-count").text(n.data.skipped),e("#import-elapsed-time").text(d+"s");var p=Math.floor(i/c*100);if(e(".import-progress-bar").css({width:p+"%","background-color":"blue",height:"25px",transition:"width 0.5s ease-in-out"}),n.data.is_complete)return t("Order Import complete!","success"),void e(".import-progress-bar").css("background-color","green");var u=new FormData;u.append("action","import_orders"),u.append("nonce",wcOrderGenerator.import_nonce),u.append("current_batch",n.data.current_batch+1),u.append("csv_file",r.get("csv_file")),u.append("batch_size",r.get("batch_size")),o(u)}else t("Order Import failed!"+n.data,"warning")},error:function(){t("Server error occurred!","error")}})}(a)})),e("#reset-order-import").on("click",(function(){exportIsGenerating=!1,e(".import-progress-bar").css("width","0%"),e("#import-total-processed, #import-success-count, #import-failed-count").text("0"),e("#import-elapsed-time").text("0s"),e(".file-upload-input").val(""),e(".file-upload-preview").html('\n            <div class="upload-placeholder">\n                <i class="upload-icon">ðŸ“¤</i>\n                <span class="upload-text">Drag & Drop or Click to Upload CSV</span>\n            </div>\n        ')}))})),jQuery(document).ready((function(e){var t=3e3;function o(n){var s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;e("#delete-".concat(n,"s-btn .poc-spinner")).show(),e("#delete-".concat(n,"s-btn")).prop("disabled",!0),e.ajax({url:wcOrderGenerator.ajaxurl,type:"POST",data:{action:"poc_get_counts",nonce:wcOrderGenerator.poc_nonce},success:function(t){if(t.success){var o="product"===n?t.data.product_count:t.data.order_count;if(0===o)return alert("No ".concat(n,"s found to delete.")),void location.reload();e("#".concat(n,"-total")).text(o);var s='\n                        <div class="info-container" style="display: flex; justify-content: space-between; margin-top: 10px;">\n                            <div style="display: flex; gap: 20px;">\n                                <div class="skip-info">Skipped: <span id="'.concat(n,'-skipped">0</span></div>\n                                <div class="retry-info">Retry: <span id="').concat(n,'-retry-count">0</span></div>\n                            </div>\n                            <div class="count-progress" id="').concat(n,'-count-progress">Progress: 0/').concat(o,"</div>\n                        </div>\n                    ");e("#".concat(n,"-progress-container .info-container")).remove(),e("#".concat(n,"-progress-container")).append(s),e("#".concat(n,"-progress-container")).slideDown(300),setTimeout((function(){r(n,0,o,0,0,0)}),500)}else a(n,t.data||"Error getting counts")},error:function(e,r,c){s<3?setTimeout((function(){o(n,s+1)}),t):a(n,"Failed to initialize after ".concat(3," attempts: ").concat(c))}})}function r(o,s,c,i,d,p){e("#".concat(o,"-retry-count")).text(p),p>0&&(i=parseInt(e("#".concat(o,"-skipped")).text())+1,e("#".concat(o,"-skipped")).text(i)),e.ajax({url:wcOrderGenerator.ajaxurl,type:"POST",timeout:3e4,data:{action:"poc_delete_".concat(o,"s_batch"),nonce:wcOrderGenerator.poc_nonce,offset:s},success:function(u){if(u.success){var l=u.data.deleted+u.data.skipped,f=d+l,v=i+(u.data.skipped||0),m=Math.round(f/c*100);e("#".concat(o,"-progress-bar")).css("width",m+"%"),e("#".concat(o,"-processed")).text(f),e("#".concat(o,"-skipped")).text(v),e("#".concat(o,"-count-progress")).text("Progress: ".concat(f,"/").concat(c)),e("#".concat(o,"-retry-count")).text("0"),u.data.errors&&u.data.errors.length,u.data.done?setTimeout((function(){n(o,v,f)}),2e3):setTimeout((function(){r(o,s+l,c,v,f,0)}),1e3)}else p<3?setTimeout((function(){r(o,s,c,i,d,p+1)}),t):a(o,u.data||"Error deleting ".concat(o,"s"))},error:function(e,n,u){p<3?setTimeout((function(){r(o,s,c,i,d,p+1)}),t):a(o,"Failed to process batch after ".concat(3," attempts: ").concat(u))}})}function n(r,s,c){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;e.ajax({url:wcOrderGenerator.ajaxurl,type:"POST",data:{action:"poc_get_counts",nonce:wcOrderGenerator.poc_nonce},success:function(t){if(t.success){var n="product"===r?t.data.product_count:t.data.order_count;0===n||n===s?(e("#delete-".concat(r,"s-btn .poc-spinner")).hide(),alert("Operation completed!\n".concat(s," ").concat(r,"s were skipped\n").concat(c-s," ").concat(r,"s have been successfully deleted!")),location.reload()):n<s?(e("#delete-".concat(r,"s-btn .poc-spinner")).hide(),alert("Operation completed!\n".concat(n," ").concat(r,"s remain\n").concat(c-n," ").concat(r,"s have been successfully deleted!")),location.reload()):setTimeout((function(){o(r)}),5e3)}else a(r,"Error verifying ".concat(r," deletion"))},error:function(e,o,d){i<3?setTimeout((function(){n(r,s,c,i+1)}),t):a(r,"Failed to verify deletion after ".concat(3," attempts: ").concat(d))}})}function a(t,o){e("#delete-".concat(t,"s-btn .poc-spinner")).hide(),e("#delete-".concat(t,"s-btn")).prop("disabled",!1),alert("Error: ".concat(o,"\nPlease try again with a smaller batch size or contact support if the issue persists."))}e("#delete-products-btn").click((function(){confirm("Are you absolutely sure you want to delete ALL products? This cannot be undone!")&&o("product")})),e("#delete-orders-btn").click((function(){confirm("Are you absolutely sure you want to delete ALL orders? This cannot be undone!")&&o("order")}))}));